import { Keplr as WindowKeplr } from "@keplr-wallet/types";
import { SigningCosmWasmClient } from "@cosmjs/cosmwasm-stargate";
import { EncodeObject } from "@cosmjs/proto-signing";
import { StdFee, GasPrice } from "@cosmjs/stargate";

import {
  WalletName,
  scopePollingDetectionStrategy,
  WalletReadyState,
} from "../base";
import { BaseSignerWalletAdapter } from "../signer";
import {
  WalletAccountError,
  WalletConnectionError,
  WalletDisconnectedError,
  WalletDisconnectionError,
  WalletError,
  WalletNotConnectedError,
  WalletNotReadyError,
  WalletPublicKeyError,
  WalletSendTransactionError,
  WalletSignTransactionError,
} from "../errors";

interface KeplrWallet extends SigningCosmWasmClient {
  address?: any;
  signTransaction({
    signerAddress,
    messages,
    fee,
    memo,
  }: {
    signerAddress: string;
    messages: EncodeObject[];
    fee: StdFee;
    memo: string;
  }): Promise<any>;
  signAndSendTransaction({
    signerAddress,
    messages,
    fee,
    memo,
  }: {
    signerAddress: string;
    messages: EncodeObject[];
    fee: number | StdFee | "auto";
    memo?: string;
  }): Promise<{ signature: any }>;
  connect(): Promise<void>;
  disconnect(): Promise<void>;
}

interface KeplrWindow extends Window {
  keplr?: WindowKeplr;
}

declare const window: KeplrWindow;

export interface KeplrWalletAdapterConfig {
  endpoint: string;
  chainId: string;
}

export const KeplrWalletName = "Keplr Wallet" as WalletName;

export class KeplrWalletAdapter extends BaseSignerWalletAdapter {
  name = KeplrWalletName;
  url =
    "https://chrome.google.com/webstore/detail/keplr/dmkamcknogkgcdfhhbddcghachkejeap";
  icon =
    "data:image/png;base64,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";

  private _connecting: boolean;
  private _wallet: KeplrWallet | null;
  private _chainId: string;
  private _endpoint: string;
  private _address: any | null;
  private _readyState: WalletReadyState =
    typeof window === "undefined" || typeof document === "undefined"
      ? WalletReadyState.Unsupported
      : WalletReadyState.NotDetected;

  constructor(config: KeplrWalletAdapterConfig) {
    super();
    this._connecting = false;
    this._wallet = null;
    this._address = null;
    this._chainId = config.chainId;
    this._endpoint = config.endpoint;

    if (this._readyState !== WalletReadyState.Unsupported) {
      scopePollingDetectionStrategy(() => {
        if (window?.keplr) {
          this._readyState = WalletReadyState.Installed;
          this.emit("readyStateChange", this._readyState);
          return true;
        }
        return false;
      });
    }
  }

  get address(): any | null {
    return this._address;
  }

  get connecting(): boolean {
    return this._connecting;
  }

  get connected(): boolean {
    return !!this._address;
  }

  get readyState(): WalletReadyState {
    return this._readyState;
  }

  async connect(): Promise<void> {
    try {
      if (this.connected || this.connecting) return;
      if (this._readyState !== WalletReadyState.Installed)
        throw new WalletNotReadyError();

      this._connecting = true;

      let wallet = null;
      let accounts = null;

      try {
        await window.keplr!.enable(this._chainId);

        const offlineSigner = window.keplr!.getOfflineSigner(this._chainId);

        accounts = await offlineSigner.getAccounts();

        // Initialize the gaia api with the offline signer that is injected by Keplr extension.
        wallet = await SigningCosmWasmClient.connectWithSigner(
          this._endpoint,
          offlineSigner,
          {
            // @ts-ignore
            gasPrice: GasPrice.fromString("0.015uosmo"),
          }
        );
      } catch (error: any) {
        throw new WalletConnectionError(error?.message, error);
      }
      if (accounts.length == 0) throw new WalletAccountError();

      let address: any;
      try {
        address = accounts[0].address;
      } catch (error: any) {
        throw new WalletPublicKeyError(error?.message, error);
      }

      this._wallet = wallet as KeplrWallet;
      this._address = address;

      this.emit("connect", address);
    } catch (error: any) {
      this.emit("error", error);
      throw error;
    } finally {
      this._connecting = false;
    }
  }

  async disconnect(): Promise<void> {
    const wallet = this._wallet;
    if (wallet) {
      // wallet.off("disconnect", this._disconnected);

      this._wallet = null;
      this._address = null;

      try {
        await wallet.disconnect();
      } catch (error: any) {
        this.emit("error", new WalletDisconnectionError(error?.message, error));
      }
    }

    this.emit("disconnect");
  }

  async sendTransaction({
    signerAddress,
    messages,
    fee,
    memo,
  }: {
    signerAddress: string;
    messages: EncodeObject[];
    fee: number | StdFee | "auto";
    memo?: string;
  }): Promise<any> {
    try {
      const wallet = this._wallet;
      if (!wallet) throw new WalletNotConnectedError();

      try {
        return await wallet.signAndBroadcast(
          signerAddress,
          messages,
          fee,
          memo
        );
      } catch (error: any) {
        if (error instanceof WalletError) throw error;
        throw new WalletSendTransactionError(error?.message, error);
      }
    } catch (error: any) {
      this.emit("error", error);
      throw error;
    }
  }

  async signTransaction({
    signerAddress,
    messages,
    fee,
    memo,
  }: {
    signerAddress: string;
    messages: EncodeObject[];
    fee: StdFee;
    memo: string;
  }): Promise<any> {
    try {
      const wallet = this._wallet;
      if (!wallet) throw new WalletNotConnectedError();

      try {
        return await wallet.sign(signerAddress, messages, fee, memo);
      } catch (error: any) {
        throw new WalletSignTransactionError(error?.message, error);
      }
    } catch (error: any) {
      this.emit("error", error);
      throw error;
    }
  }

  private _disconnected = () => {
    const wallet = this._wallet;
    if (wallet) {
      // wallet.off("disconnect", this._disconnected);

      this._wallet = null;
      this._address = null;

      this.emit("error", new WalletDisconnectedError());
      this.emit("disconnect");
    }
  };
}
